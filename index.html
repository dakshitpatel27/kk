<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KAIVAL KRUPA ELECTRIC BIKE WORLD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-dark: #05060a;
      --bg-card: #111827;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --accent-2: #38bdf8;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --border-subtle: #1f2937;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #0f172a 0, #020617 60%);
      color: var(--text-main);
      min-height: 100vh;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.25rem;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(16px);
      background: rgba(15, 23, 42, 0.9);
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1.25rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1rem;
      color: #ecfeff;
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
    }

    .brand-text-main {
      font-weight: 700;
      font-size: 1.05rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .brand-text-sub {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      font-size: 0.9rem;
    }

    .nav-links button {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      transition: all 0.2s;
      font-size: 0.85rem;
    }

    .nav-links button:hover {
      color: var(--text-main);
      background: rgba(148, 163, 184, 0.15);
    }

    .pill {
      background: var(--accent-soft);
      color: var(--accent);
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      border: 1px solid rgba(34, 197, 94, 0.5);
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    main {
      padding: 1.25rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 3fr 1.3fr;
      gap: 1.25rem;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .nav {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #020617, #020617 30%, #020617);
      border-radius: 1.3rem;
      padding: 1.1rem 1.2rem;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.85);
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.7rem;
    }

    .hero-title {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: baseline;
      gap: 0.4rem;
    }

    .hero-highlight {
      color: var(--accent-2);
      font-size: 0.95rem;
      font-weight: 500;
    }

    .hero-sub {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
    }

    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
      margin-top: 0.7rem;
      font-size: 0.75rem;
    }

    .stat-pill {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .search-row {
      margin-top: 0.85rem;
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-input-wrap {
      position: relative;
      flex: 1;
      min-width: 180px;
    }

    .search-input-wrap input {
      width: 100%;
      padding: 0.55rem 0.9rem 0.55rem 2.1rem;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 0.85rem;
      outline: none;
    }

    .search-input-wrap input::placeholder {
      color: #6b7280;
    }

    .search-icon {
      position: absolute;
      top: 50%;
      left: 0.7rem;
      transform: translateY(-50%);
      font-size: 0.85rem;
      color: #6b7280;
    }

    .category-select {
      padding: 0.5rem 0.8rem;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 0.8rem;
    }

    .products-grid {
      margin-top: 1rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 0.85rem;
    }

    .product-card {
      background: linear-gradient(145deg, #020617, #020617 55%, #04101a);
      border-radius: 1rem;
      padding: 0.7rem;
      border: 1px solid #111827;
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
      position: relative;
      overflow: hidden;
    }

    .product-image-wrap {
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.3), #020617 70%);
      border-radius: 0.8rem;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 0.3rem;
    }

    .product-image-wrap img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .product-category {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent-2);
    }

    .product-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .product-desc {
      font-size: 0.72rem;
      color: var(--text-muted);
      min-height: 2.2em;
    }

    .product-bottom-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.3rem;
    }

    .product-price {
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--accent);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 0.4rem 0.9rem;
      font-size: 0.78rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-weight: 500;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.35);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.45);
    }

    .btn-outline {
      background: transparent;
      color: var(--accent);
      border: 1px solid rgba(34, 197, 94, 0.5);
    }

    .btn-sm {
      padding: 0.3rem 0.7rem;
      font-size: 0.72rem;
    }

    .cart-card {
      position: sticky;
      top: 72px;
    }

    .cart-title {
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cart-items {
      margin-top: 0.7rem;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 0.1rem;
    }

    .cart-item {
      padding: 0.45rem 0.35rem;
      border-radius: 0.7rem;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid #111827;
      margin-bottom: 0.4rem;
      font-size: 0.78rem;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 0.35rem;
      align-items: center;
    }

    .cart-item-main {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .cart-item-name {
      font-weight: 500;
    }

    .cart-item-meta {
      color: var(--text-muted);
      font-size: 0.7rem;
    }

    .cart-item-actions {
      text-align: right;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.2rem;
    }

    .qty-input {
      width: 48px;
      padding: 0.22rem 0.3rem;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: var(--text-main);
      font-size: 0.72rem;
      text-align: center;
      outline: none;
    }

    .cart-total {
      border-top: 1px dashed #374151;
      padding-top: 0.5rem;
      margin-top: 0.4rem;
      font-size: 0.86rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .total-label {
      color: var(--text-muted);
    }

    .total-value {
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent);
    }

    .checkout-form {
      margin-top: 0.6rem;
      display: grid;
      gap: 0.4rem;
      font-size: 0.78rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .field label {
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .field input,
    .field textarea {
      border-radius: 0.8rem;
      border: 1px solid #374151;
      padding: 0.4rem 0.6rem;
      background: #020617;
      color: var(--text-main);
      outline: none;
      font-size: 0.78rem;
    }

    .field textarea {
      resize: vertical;
      min-height: 55px;
    }

    .helper-text {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .status-msg {
      margin-top: 0.4rem;
      font-size: 0.78rem;
    }

    .status-success {
      color: var(--accent);
    }

    .status-error {
      color: var(--danger);
    }

    .badge {
      border-radius: 999px;
      padding: 0.1rem 0.5rem;
      border: 1px solid #4b5563;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .admin-section {
      margin-top: 1.25rem;
      display: none;
    }

    .admin-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      gap: 0.6rem;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 0.8rem;
    }

    @media (max-width: 900px) {
      .admin-grid {
        grid-template-columns: 1fr;
      }
    }

    .admin-list {
      max-height: 260px;
      overflow-y: auto;
      border-radius: 0.9rem;
      border: 1px solid #111827;
      background: rgba(15, 23, 42, 0.9);
      padding: 0.45rem;
      font-size: 0.78rem;
    }

    .admin-item {
      padding: 0.42rem 0.3rem;
      border-radius: 0.6rem;
      border: 1px solid #1f2937;
      margin-bottom: 0.3rem;
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) auto;
      gap: 0.35rem;
    }

    .admin-item-actions {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      align-items: flex-end;
      justify-content: center;
    }

    .link-muted {
      font-size: 0.72rem;
      color: var(--text-muted);
      cursor: pointer;
      text-decoration: underline;
      text-decoration-style: dotted;
    }

    .footer {
      margin-top: 1.5rem;
      padding: 1rem 1.25rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      border-top: 1px solid #111827;
      text-align: center;
    }

    .mt-1 {
      margin-top: 0.25rem;
    }
    .mt-2 {
      margin-top: 0.5rem;
    }
    .mt-3 {
      margin-top: 0.75rem;
    }

  </style>
</head>
<body>
<header>
  <div class="nav container">
    <div class="brand">
      <div class="brand-logo">EV</div>
      <div>
        <div class="brand-text-main">KAIVAL KRUPA ELECTRIC BIKE WORLD</div>
        <div class="brand-text-sub">EV Bike Spare Parts ‚Ä¢ Service ‚Ä¢ Support</div>
      </div>
    </div>
    <div class="nav-links">
      <span class="pill">
        <span>‚ö°</span>
        EV Parts Online Store
      </span>
      <button type="button" id="navShopBtn">Shop</button>
      <button type="button" id="navAdminBtn">Admin</button>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="card-header-row">
      <div>
        <div class="hero-title">
          EV Bike Spare Parts
          <span class="hero-highlight">Fast ‚Ä¢ Genuine ‚Ä¢ Ready to Ship</span>
        </div>
        <p class="hero-sub">
          Browse genuine electric bike spare parts, add them to cart and send your order directly on WhatsApp.
        </p>
        <div class="stats-row">
          <div class="stat-pill">üö≤ EV Motors & Controllers</div>
          <div class="stat-pill">üîã Batteries & Chargers</div>
          <div class="stat-pill">üõû Tyres & Brakes</div>
          <div class="stat-pill">‚ú® Body & Accessories</div>
        </div>
      </div>
      <div>
        <span class="badge">WhatsApp Orders: +91 94292 93754</span>
      </div>
    </div>

    <!-- Shop Area -->
    <div id="shopSection">
      <div class="search-row">
        <div class="search-input-wrap">
          <span class="search-icon">üîç</span>
          <input id="searchInput" type="text" placeholder="Search spare part by name‚Ä¶" />
        </div>
        <select id="categoryFilter" class="category-select">
          <option value="all">All Categories</option>
        </select>
      </div>

      <div id="productsGrid" class="products-grid mt-3"></div>
    </div>

    <!-- Admin Area -->
    <div id="adminSection" class="admin-section">
      <div class="admin-header-row">
        <div>
          <div class="hero-title" style="font-size: 1.05rem;">
            Admin Panel
            <span class="hero-highlight">Manage EV Spare Parts</span>
          </div>
          <p class="hero-sub">
            Add, edit or delete spare parts. Changes are stored in this browser using local storage.
          </p>
        </div>
        <div class="helper-text">
          üîê Basic protection only.  
          For real security, use a backend with authentication.
        </div>
      </div>

      <div class="admin-grid">
        <div class="card" style="padding:0.7rem 0.75rem;">
          <div style="font-size:0.9rem; font-weight:600; margin-bottom:0.35rem;">
            Part Details
          </div>
          <form id="adminForm" class="checkout-form">
            <input type="hidden" id="partId" />
            <div class="field">
              <label for="partName">Part Name</label>
              <input id="partName" required />
            </div>
            <div class="field">
              <label for="partCategory">Category</label>
              <input id="partCategory" placeholder="Motor, Battery, Tyre‚Ä¶" />
            </div>
            <div class="field">
              <label for="partPrice">Price (‚Çπ)</label>
              <input id="partPrice" type="number" min="0" step="1" required />
            </div>
            <div class="field">
              <label for="partImage">Image URL</label>
              <input id="partImage" placeholder="https://example.com/part.png" />
              <span class="helper-text">
                Use a direct image link. You can upload images to any static host and paste the link here.
              </span>
            </div>
            <div class="field">
              <label for="partDesc">Short Description</label>
              <textarea id="partDesc" rows="2"></textarea>
            </div>

            <div style="display:flex; gap:0.5rem; margin-top:0.3rem;">
              <button class="btn btn-primary btn-sm" type="submit">
                üíæ Save Part
              </button>
              <button class="btn btn-outline btn-sm" type="button" id="adminResetBtn">
                ‚ú® Clear Form
              </button>
            </div>
            <div class="helper-text mt-1">
              Tip: Click "Edit" in the list to modify an existing part.
            </div>
          </form>
        </div>

        <div class="admin-list">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.35rem;">
            <span style="font-size:0.9rem; font-weight:600;">Spare Parts List</span>
            <span class="helper-text">Showing all saved parts</span>
          </div>
          <div id="adminList"></div>
        </div>
      </div>
    </div>
  </section>

  <section class="layout mt-3">
    <!-- Empty left area just to keep layout balanced on big screens -->
    <div></div>

    <!-- Cart & Checkout -->
    <aside class="card cart-card">
      <div class="cart-title">
        <span>üõí Cart</span>
        <span id="cartCount" class="badge">0 items</span>
      </div>

      <div id="cartItems" class="cart-items"></div>

      <div class="cart-total">
        <span class="total-label">Total</span>
        <span id="cartTotal" class="total-value">‚Çπ0</span>
      </div>

      <form id="checkoutForm" class="checkout-form">
        <div class="field">
          <label for="custName">Customer Name</label>
          <input id="custName" required />
        </div>
        <div class="field">
          <label for="custPhone">Phone Number</label>
          <input id="custPhone" required placeholder="10-digit mobile number" />
        </div>
        <div class="field">
          <label for="custAddress">Address</label>
          <textarea id="custAddress" rows="2" required></textarea>
        </div>
        <div class="field">
          <label for="custNote">Additional Note (optional)</label>
          <textarea id="custNote" rows="2" placeholder="Preferred delivery time, landmark, etc."></textarea>
        </div>
        <div class="helper-text">
          On submit, your order will open in WhatsApp chat to <b>+91 94292 93754</b>.  
          You can review and send it from WhatsApp.
        </div>

        <button class="btn btn-primary mt-2" type="submit">
          üì≤ Order on WhatsApp
        </button>

        <div id="statusMsg" class="status-msg"></div>
      </form>
    </aside>
  </section>

  <footer class="footer">
    ¬© <span id="yearSpan"></span> KAIVAL KRUPA ELECTRIC BIKE WORLD ‚Ä¢ EV Bike Spare Parts & Service.
  </footer>
</main>

<script>
  // ---------- CONFIG ----------
  const WHATSAPP_NUMBER = "919429293754"; // Country code + number (no + sign)
  const STORAGE_KEY_PRODUCTS = "kkebw_products_v1";

  // ---------- STATE ----------
  let products = [];
  let cart = [];
  let adminUnlocked = false;

  // ---------- UTIL ----------
  function formatCurrency(value) {
    return "‚Çπ" + (value || 0).toLocaleString("en-IN");
  }

  function saveProductsToStorage() {
    localStorage.setItem(STORAGE_KEY_PRODUCTS, JSON.stringify(products));
  }

  function loadProductsFromStorage() {
    const stored = localStorage.getItem(STORAGE_KEY_PRODUCTS);
    if (stored) {
      try {
        products = JSON.parse(stored);
      } catch (e) {
        console.error("Error parsing products from storage", e);
        products = [];
      }
    }

    // seed sample products if empty
    if (!Array.isArray(products) || products.length === 0) {
      products = [
        {
          id: "P001",
          name: "48V Hub Motor (1000W)",
          category: "Motor",
          price: 8500,
          image:
            "https://images.pexels.com/photos/163184/wheel-bike-bicycle-cycling-163184.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "High torque 48V hub motor suitable for most EV bikes."
        },
        {
          id: "P002",
          name: "Lithium-ion Battery Pack 48V 28Ah",
          category: "Battery",
          price: 18500,
          image:
            "https://images.pexels.com/photos/1105379/pexels-photo-1105379.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Long life lithium battery pack with BMS protection."
        },
        {
          id: "P003",
          name: "Controller 48V/60A (Sine Wave)",
          category: "Controller",
          price: 4500,
          image:
            "https://images.pexels.com/photos/5721076/pexels-photo-5721076.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Smooth acceleration with sine wave technology."
        },
        {
          id: "P004",
          name: "EV Tyre 3.00-10 Tubeless",
          category: "Tyre",
          price: 1600,
          image:
            "https://images.pexels.com/photos/414916/pexels-photo-414916.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Heavy duty tyre for electric two-wheelers."
        },
        {
          id: "P005",
          name: "Disc Brake Kit (Front)",
          category: "Brake",
          price: 2100,
          image:
            "https://images.pexels.com/photos/102292/pexels-photo-102292.jpeg?auto=compress&cs=tinysrgb&w=600",
          desc: "Complete front disc brake assembly for EV bikes."
        }
      ];
      saveProductsToStorage();
    }
  }

  function getUniqueCategories() {
    const set = new Set();
    products.forEach((p) => {
      if (p.category && p.category.trim()) {
        set.add(p.category.trim());
      }
    });
    return Array.from(set);
  }

  // ---------- RENDER: PRODUCTS ----------
  function renderProducts() {
    const grid = document.getElementById("productsGrid");
    const searchValue = document
      .getElementById("searchInput")
      .value.toLowerCase()
      .trim();
    const categoryValue = document.getElementById("categoryFilter").value;

    grid.innerHTML = "";

    let filtered = products.filter((p) => {
      const matchesSearch =
        !searchValue ||
        p.name.toLowerCase().includes(searchValue) ||
        (p.desc && p.desc.toLowerCase().includes(searchValue));
      const matchesCategory =
        categoryValue === "all" || p.category === categoryValue;
      return matchesSearch && matchesCategory;
    });

    if (filtered.length === 0) {
      grid.innerHTML =
        '<div style="font-size:0.85rem; color:#9ca3af;">No parts found. Try a different search or category.</div>';
      return;
    }

    filtered.forEach((p) => {
      const card = document.createElement("div");
      card.className = "product-card";

      card.innerHTML = `
        <div class="product-image-wrap">
          ${
            p.image
              ? `<img src="${p.image}" alt="${p.name}" onerror="this.style.display='none';" />`
              : '<span style="font-size:2rem; opacity:0.3;">‚ö°</span>'
          }
        </div>
        <div class="product-category">${p.category || "EV Part"}</div>
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.desc || ""}</div>
        <div class="product-bottom-row">
          <div class="product-price">${formatCurrency(p.price)}</div>
          <button class="btn btn-primary btn-sm" type="button" data-id="${
            p.id
          }">
            ‚ûï Add
          </button>
        </div>
      `;

      const addBtn = card.querySelector("button");
      addBtn.addEventListener("click", () => addToCart(p.id));

      grid.appendChild(card);
    });
  }

  function populateCategoryFilter() {
    const select = document.getElementById("categoryFilter");
    const cats = getUniqueCategories();
    select.innerHTML = `<option value="all">All Categories</option>`;
    cats.forEach((c) => {
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      select.appendChild(opt);
    });
  }

  // ---------- CART ----------
  function addToCart(productId) {
    const product = products.find((p) => p.id === productId);
    if (!product) return;
    const existing = cart.find((c) => c.id === productId);
    if (existing) {
      existing.qty += 1;
    } else {
      cart.push({
        id: product.id,
        name: product.name,
        price: product.price,
        qty: 1
      });
    }
    renderCart();
  }

  function updateCartQty(index, qty) {
    const val = parseInt(qty, 10);
    if (isNaN(val) || val <= 0) return;
    cart[index].qty = val;
    renderCart();
  }

  function removeCartItem(index) {
    cart.splice(index, 1);
    renderCart();
  }

  function renderCart() {
    const container = document.getElementById("cartItems");
    const countSpan = document.getElementById("cartCount");
    const totalSpan = document.getElementById("cartTotal");

    container.innerHTML = "";

    if (cart.length === 0) {
      container.innerHTML =
        '<div style="font-size:0.8rem; color:#9ca3af;">Your cart is empty. Add some parts to order.</div>';
      countSpan.textContent = "0 items";
      totalSpan.textContent = "‚Çπ0";
      return;
    }

    let total = 0;

    cart.forEach((item, index) => {
      const lineTotal = item.price * item.qty;
      total += lineTotal;

      const row = document.createElement("div");
      row.className = "cart-item";
      row.innerHTML = `
        <div class="cart-item-main">
          <div class="cart-item-name">${item.name}</div>
          <div class="cart-item-meta">
            ${formatCurrency(item.price)} √ó
            <input class="qty-input" type="number" min="1" value="${
              item.qty
            }" />
          </div>
        </div>
        <div class="cart-item-actions">
          <div>${formatCurrency(lineTotal)}</div>
          <button type="button" class="btn btn-outline btn-sm">‚úñ Remove</button>
        </div>
      `;

      const qtyInput = row.querySelector(".qty-input");
      qtyInput.addEventListener("change", (e) =>
        updateCartQty(index, e.target.value)
      );

      const removeBtn = row.querySelector("button");
      removeBtn.addEventListener("click", () => removeCartItem(index));

      container.appendChild(row);
    });

    countSpan.textContent = cart.length + (cart.length === 1 ? " item" : " items");
    totalSpan.textContent = formatCurrency(total);
  }

  // ---------- CHECKOUT / WHATSAPP ----------
  function handleCheckoutSubmit(e) {
    e.preventDefault();
    const status = document.getElementById("statusMsg");
    status.textContent = "";
    status.className = "status-msg";

    if (cart.length === 0) {
      status.textContent = "Please add at least one part to the cart before ordering.";
      status.classList.add("status-error");
      return;
    }

    const name = document.getElementById("custName").value.trim();
    const phone = document.getElementById("custPhone").value.trim();
    const address = document.getElementById("custAddress").value.trim();
    const note = document.getElementById("custNote").value.trim();

    if (!name || !phone || !address) {
      status.textContent = "Name, phone and address are required.";
      status.classList.add("status-error");
      return;
    }

    const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);

    let message = "New Order ‚Äì KAIVAL KRUPA ELECTRIC BIKE WORLD%0A%0A";
    message += "*Customer Details*%0A";
    message += "Name: " + encodeURIComponent(name) + "%0A";
    message += "Phone: " + encodeURIComponent(phone) + "%0A";
    message += "Address: " + encodeURIComponent(address) + "%0A";
    if (note) {
      message += "Note: " + encodeURIComponent(note) + "%0A";
    }
    message += "%0A*Items Ordered*%0A";

    cart.forEach((item, idx) => {
      message +=
        encodeURIComponent(
          (idx + 1) +
            ". " +
            item.name +
            " | Qty: " +
            item.qty +
            " | Price: " +
            formatCurrency(item.price)
        ) + "%0A";
    });

    message += "%0A*Total Amount:* " + encodeURIComponent(formatCurrency(total));

    const url = "https://wa.me/" + WHATSAPP_NUMBER + "?text=" + message;

    // Show thank you message before redirecting
    status.textContent =
      "Thank you for ordering with KAIVAL KRUPA ELECTRIC BIKE WORLD! WhatsApp will open now. Please review and send your order.";
    status.classList.add("status-success");

    // Clear cart visually
    cart = [];
    renderCart();

    // Open WhatsApp in new tab/window
    window.open(url, "_blank");
  }

  // ---------- ADMIN ----------
  function promptAdminPassword() {
    if (adminUnlocked) {
      showAdminSection(true);
      return;
    }
    const pwd = window.prompt("Enter admin password to manage parts:");
    // Simple demo password (change it if you like)
    if (pwd === "kk@admin") {
      adminUnlocked = true;
      alert("Admin access granted.");
      showAdminSection(true);
    } else if (pwd !== null) {
      alert("Incorrect password.");
      showAdminSection(false);
    }
  }

  function showAdminSection(show) {
    const adminSection = document.getElementById("adminSection");
    const shopSection = document.getElementById("shopSection");
    if (show) {
      adminSection.style.display = "block";
      shopSection.style.display = "none";
    } else {
      adminSection.style.display = "none";
      shopSection.style.display = "block";
    }
  }

  function handleAdminFormSubmit(e) {
    e.preventDefault();
    const idField = document.getElementById("partId");
    const nameField = document.getElementById("partName");
    const catField = document.getElementById("partCategory");
    const priceField = document.getElementById("partPrice");
    const imageField = document.getElementById("partImage");
    const descField = document.getElementById("partDesc");

    const name = nameField.value.trim();
    const price = parseFloat(priceField.value || "0");
    const category = catField.value.trim() || "General";
    const image = imageField.value.trim();
    const desc = descField.value.trim();

    if (!name || isNaN(price) || price <= 0) {
      alert("Please enter a valid name and price.");
      return;
    }

    if (idField.value) {
      // update existing
      const idx = products.findIndex((p) => p.id === idField.value);
      if (idx >= 0) {
        products[idx].name = name;
        products[idx].category = category;
        products[idx].price = price;
        products[idx].image = image;
        products[idx].desc = desc;
      }
    } else {
      // create new id
      const newId = "P" + String(Date.now()).slice(-6);
      products.push({
        id: newId,
        name,
        category,
        price,
        image,
        desc
      });
    }

    saveProductsToStorage();
    renderProducts();
    populateCategoryFilter();
    renderAdminList();
    resetAdminForm();
  }

  function resetAdminForm() {
    document.getElementById("partId").value = "";
    document.getElementById("adminForm").reset();
  }

  function renderAdminList() {
    const list = document.getElementById("adminList");
    list.innerHTML = "";
    if (!products.length) {
      list.innerHTML =
        '<div style="font-size:0.8rem; color:#9ca3af;">No parts saved yet.</div>';
      return;
    }

    products.forEach((p) => {
      const row = document.createElement("div");
      row.className = "admin-item";
      row.innerHTML = `
        <div>
          <div style="font-weight:500;">${p.name}</div>
          <div style="font-size:0.72rem; color:#9ca3af;">
            ${p.category || "EV Part"} ‚Ä¢ ${formatCurrency(p.price)}
          </div>
          <div style="font-size:0.7rem; color:#6b7280; margin-top:0.15rem;">
            ${p.desc || ""}
          </div>
        </div>
        <div class="admin-item-actions">
          <button class="btn btn-outline btn-sm" type="button">‚úè Edit</button>
          <button class="btn btn-outline btn-sm" type="button">üóë Delete</button>
        </div>
      `;

      const [editBtn, delBtn] = row.querySelectorAll("button");
      editBtn.addEventListener("click", () => fillAdminFormForEdit(p.id));
      delBtn.addEventListener("click", () => deleteProduct(p.id));

      list.appendChild(row);
    });
  }

  function fillAdminFormForEdit(id) {
    const p = products.find((x) => x.id === id);
    if (!p) return;
    document.getElementById("partId").value = p.id;
    document.getElementById("partName").value = p.name;
    document.getElementById("partCategory").value = p.category || "";
    document.getElementById("partPrice").value = p.price;
    document.getElementById("partImage").value = p.image || "";
    document.getElementById("partDesc").value = p.desc || "";
  }

  function deleteProduct(id) {
    if (!confirm("Delete this part permanently?")) return;
    products = products.filter((p) => p.id !== id);
    saveProductsToStorage();
    renderProducts();
    populateCategoryFilter();
    renderAdminList();
  }

  // ---------- NAV ----------
  function attachNavHandlers() {
    document
      .getElementById("navShopBtn")
      .addEventListener("click", () => showAdminSection(false));
    document
      .getElementById("navAdminBtn")
      .addEventListener("click", promptAdminPassword);
  }

  // ---------- INIT ----------
  function init() {
    document.getElementById("yearSpan").textContent =
      new Date().getFullYear();

    loadProductsFromStorage();
    populateCategoryFilter();
    renderProducts();
    renderCart();
    renderAdminList();

    document
      .getElementById("searchInput")
      .addEventListener("input", renderProducts);
    document
      .getElementById("categoryFilter")
      .addEventListener("change", renderProducts);
    document
      .getElementById("checkoutForm")
      .addEventListener("submit", handleCheckoutSubmit);
    document
      .getElementById("adminForm")
      .addEventListener("submit", handleAdminFormSubmit);
    document
      .getElementById("adminResetBtn")
      .addEventListener("click", resetAdminForm);

    attachNavHandlers();
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
